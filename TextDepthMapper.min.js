!function(){var t={font:"18px Arial, sans-serif",textAlign:"left",verticalAlign:"top",paddingX:0,paddingY:0,fitParent:!1,lineBreak:"auto",sizeToFill:!1};window.CanvasTextWrapper=function(e,i,r){if(!(this instanceof CanvasTextWrapper))throw new TypeError('CanvasTextWrapper constructor failed. Use "new" keyword when instantiating.');this.canvas=e,this.text=i;for(var n in t)this[n]=r&&r[n]?r[n]:t[n];this.lineHeight=parseInt(this.font.replace(/^\D+/g,""),10),this.validate(),this.context=this.canvas.getContext("2d"),this.context.font=this.font,this.context.textBaseline="bottom",this.drawText()},CanvasTextWrapper.prototype={drawText:function(){var t=this.fitParent===!1?this.canvas.width:this.canvas.parentNode.clientWidth,e={x:0,y:0};if(this.sizeToFill){var i=(this.fitParent===!1?this.canvas.height:this.canvas.parentNode.clientHeight)-2*this.paddingX,r=this.text.trim().split(/\s+/).length,n=0;do this.setFontSize(++n);while(s<i&&a.join(" ").split(/\s+/).length===r);this.setFontSize(--n)}var a=this.getWrappedText(t),s=a.length*this.lineHeight;this.setTextVerticalAlign(e,s);for(var o=0;o<a.length;o++)this.setTextHorizontalAlign(this.context,e,t,a[o]),e.y=parseInt(e.y,10)+parseInt(this.lineHeight,10),this.context.fillText(a[o],e.x,e.y)},setFontSize:function(t){var e=this.context.font.split(/\b\d+px\b/i);this.context.font=e[0]+t+"px"+e[1],this.lineHeight=t},getWrappedText:function(t){var e=t-2*this.paddingX,i=this.text.trim().split(/\s+/),r=[];return this.checkWordsLength(this.context,i,e),this.breakTextIntoLines(this.context,r,i,e),r},checkWordsLength:function(t,e,i){for(var r=0;r<e.length;r++){var n="",a=t.measureText(e[r]).width;if(a>i){for(var s=0;t.measureText(n+e[r][s]).width<=i&&s<e[r].length;s++)n+=e[r][s];var o=e[r].slice(0,s),h=e[r].slice(s);e.splice(r,1,o,h)}}},breakTextIntoLines:function(t,e,i,r){for(var n=0,a=0;n<i.length;a++)if(e[a]="","auto"===this.lineBreak){for(;t.measureText(e[a]+i[n]).width<=r&&n<i.length;)e[a]+=i[n]+" ",n++;e[a]=e[a].trim()}else"word"===this.lineBreak&&(e[a]=i[n],n++)},setTextHorizontalAlign:function(t,e,i,r){"center"===this.textAlign?e.x=(i-t.measureText(r).width)/2:"right"===this.textAlign?e.x=i-t.measureText(r).width-this.paddingX:e.x=this.paddingX},setTextVerticalAlign:function(t,e){var i=this.fitParent===!1?this.canvas.height:this.canvas.parentNode.clientHeight;"middle"===this.verticalAlign?t.y=(i-e)/2:"bottom"===this.verticalAlign?t.y=i-e-this.paddingY:t.y=this.paddingY},validate:function(){if(!(this.canvas instanceof HTMLCanvasElement))throw new TypeError("From CanvasTextWrapper(): Element passed as the first parameter is not an instance of HTMLCanvasElement.");if("string"!=typeof this.text)throw new TypeError("From CanvasTextWrapper(): The second, dedicated for the text, parameter must be a string.");if(isNaN(this.lineHeight))throw new TypeError('From CanvasTextWrapper(): Cannot parse font size as an Integer. Check "font" property\'s value.');if("left"!==this.textAlign&&"center"!==this.textAlign&&"right"!==this.textAlign)throw new TypeError('From CanvasTextWrapper(): Unsupported horizontal align value is used. Property "textAlign" can only be set to "left", "center", or "right".');if("top"!==this.verticalAlign&&"middle"!==this.verticalAlign&&"bottom"!==this.verticalAlign)throw new TypeError('From CanvasTextWrapper(): Unsupported vertical align value is used. Property "verticalAlign" can only be set to "top", "middle", or "bottom".');if(isNaN(this.paddingX))throw new TypeError('From CanvasTextWrapper(): Unsupported horizontal padding value is used. Property "paddingX" must be set to a number');if(isNaN(this.paddingY))throw new TypeError('From CanvasTextWrapper(): Unsupported vertical padding value is used. Property "paddingY" must be set to a number.');if("boolean"!=typeof this.fitParent)throw new TypeError('From CanvasTextWrapper(): Property "fitParent" must be set to a Boolean.');if("auto"!==this.lineBreak&&"word"!==this.lineBreak)throw new TypeError('From CanvasTextWrapper(): Unsupported line break value is used. Property "lineBreak" can only be set to "auto", or "word".');if("boolean"!=typeof this.sizeToFill)throw new TypeError('From CanvasTextWrapper(): Property "sizeToFill" must be set to a Boolean.')}}}(),MagicEye.TextDepthMapper=MagicEye.DepthMapper.extend({constructor:function(t,e){this.text=t,this.opts=e},make:function(t,e){var i=document.createElement("canvas");i.width=t,i.height=e;var r=i.getContext("2d");r.fillStyle="rgb(0, 0, 0)",r.fillRect(0,0,t,e),r.fillStyle="rgb(255,255,255)";var n={font:"bold 48px Helvetica, Arial, sans-serif",paddingX:Math.round(.1*t),paddingY:Math.round(.1*e),sizeToFill:!0,verticalAlign:"middle"};this.opts=this.opts||{};for(var a in n)this.opts[a]=this.opts&&this.opts[a]?this.opts[a]:n[a];new CanvasTextWrapper(i,this.text,this.opts);var s,o,h,l=[],p=r.getImageData(0,0,t,e).data;for(o=0;o<e;o++)for(l[o]=new Float32Array(t),h=t*o*4,s=0;s<t;s++)l[o][s]=p[h+4*s]/255;return l}});